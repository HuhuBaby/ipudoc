# 接口开发

这里的接口指的是IPU的客户端调用服务端的数据接口。接口开发有一套统一的标准：接口名+格式化的参数。



现在的需求是要在Display工程中增加一个登陆接口，我们创建了整个工程基础Bean父类DisplayBean，它继承自AbstractBean。实现步骤如下：

## 1.创建类和方法

创建LoginBean类，继承IpuAppBean，增加方法login。入参固定为IData结构的参数，只有一个。返回单条数据出参是IData结构，返回多条数据出参是IDataset结构。

```java
public class LoginBean extends IpuAppBean{
    	public IData login(IData param) throws Exception{
//		/*登陆逻辑，略*/
//		boolean isSuccess = true; //登陆成功
//		if(isSuccess){
//			IpuContextData contextData = new IpuContextData();
//			contextData.setAccount(param.getString("ACCOUNT"));
//			String sessionId = IpuSessionManager.getInstance().createSession(contextData);
//			param.put(Constant.Session.SESSION_ID, sessionId);
//		}else{
//			MobileUtility.error("登陆失败!");
//		}
		return param;
	}
}
```

> 注：业务Bean是被单例化以后常驻内存的，所以为规避线程问题，业务Bean中不能使用可以修改的全局变量，即全局变量必须使用final修饰。

对于每个接口的实现，通常有两种方式：

1. IPU接口调用核心系统的数据接口，只做接口转发和格式转换。

2. 直接操作数据库，可以参见本站中的`数据库持久层`。

   

## 2.配置etc/server-data.xml

```xml
<action name="LoginBean.login" class="com.ai.server.ioo.bean.LoginBean" method="login" verify="false" encrypt="false"></action>
```

> server-page.xml的属性含义参见本站中的`配置文件介绍`



## 3.如何使用

在JS中使用`dataRequest(dataAction,param,callback)` 调用数据接口，其中callback为回调函数，dataAction为数据接口名，param为参数。




<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.css">
<script src="../../source/md5.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.min.js"></script>
<div id="gitalk-container"></div>
<script>
  var gitalk = new Gitalk({
    "clientID": "f8eec1cd59e53d8158d2",
    "clientSecret": "83873640a1aa569a87ab8d07b210efe35b6797b8",
    "repo": "IPU-DOCUMENT",
    "owner": "luckywangyj",
    "admin": ["luckywangyj"],
    "id": md5(location.href),
    "distractionFreeMode": false  
  });
  gitalk.render("gitalk-container");
</script>



